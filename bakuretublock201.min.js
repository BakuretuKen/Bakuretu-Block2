// 爆裂ブロック 重ね着バージョン JavaScript版 ver1.00
// https://bakuretuken.com/block/
if(typeof BLOCK_GAME_MIN_BLOCK_PIXEL=='undefined'){if(BLOCK_GAME_BLOCK_SIZE==0x20)var BLOCK_GAME_MIN_BLOCK_PIXEL=0x18;else var BLOCK_GAME_MIN_BLOCK_PIXEL=0x6;}BLOCK_GAME_WIDTH%BLOCK_GAME_BLOCK_SIZE!=0x0&&alert('BLOCK_GAME_WIDTH\x20is\x20not\x20a\x20multiple\x20of\x20BLOCK_GAME_BLOCK_SIZE');BLOCK_GAME_HEIGHT%BLOCK_GAME_BLOCK_SIZE!=0x0&&alert('BLOCK_GAME_HEIGHT\x20is\x20not\x20a\x20multiple\x20of\x20BLOCK_GAME_BLOCK_SIZE');enchant();var game=new Game(BLOCK_GAME_WIDTH,BLOCK_GAME_HEIGHT);game['preload']('block_image_front1.png','block_image_front2.png','block_image_back.jpg','block_image_win.jpg','block_icon_menu.png','block_icon_boll.png','block_icon_panel.png'),game['fps']=BLOCK_GAME_FPS,game['mode']=0x0,game['lifeLabel']=new Label();var scene=new Scene(),imgFront1=new Image(),imgFront2=new Image(),imgBack=new Image(),imgWin=new Image(),sf=new Surface(BLOCK_GAME_WIDTH,BLOCK_GAME_HEIGHT),touchPos=-0x1,blockBaseNum=0x0,blockBaseNumMaster=0x0,blockBase=new Array(BLOCK_GAME_WIDTH/BLOCK_GAME_BLOCK_SIZE);for(var k=0x0;k<blockBase['length'];k++)blockBase[k]=new Array(BLOCK_GAME_HEIGHT/BLOCK_GAME_BLOCK_SIZE);var blockBaseMaster=new Array(BLOCK_GAME_WIDTH/BLOCK_GAME_BLOCK_SIZE);for(var k=0x0;k<blockBaseMaster['length'];k++)blockBaseMaster[k]=new Array(BLOCK_GAME_HEIGHT/BLOCK_GAME_BLOCK_SIZE);StartLabelSprite=Class['create'](Sprite,{'initialize':function(){Sprite['call'](this,0x200,0x80),this['image']=game['assets']['block_icon_menu.png'],this['init']();},'init':function(){this['frame']=0x0,this['x']=BLOCK_GAME_WIDTH/0x2-this['width']/0x2,this['y']=BLOCK_GAME_HEIGHT/0x2-this['height']/0x2;},'ontouchstart':function(_0x5e739b){if(game['mode']==0x0)gameStart();if(game['mode']==0x9||game['mode']==0xa)gameRestart();}}),SpriteScreen=Class['create'](Sprite,{'initialize':function(){Sprite['call'](this,BLOCK_GAME_WIDTH,BLOCK_GAME_HEIGHT);},'ontouchstart':function(_0x5edd80){touchPos=_0x5edd80['x'];},'ontouchend':function(_0x35841f){touchPos=-0x1;},'ontouchmove':function(_0x5a273b){if(touchPos==-0x1)return;var _0x13e0af=_0x5a273b['x']-touchPos;touchPos=_0x5a273b['x'],game['bar']['x']=game['bar']['x']+_0x13e0af;if(game['bar']['x']<0x0)game['bar']['x']=0x0;if(game['bar']['x']>BLOCK_GAME_WIDTH-0x78)game['bar']['x']=BLOCK_GAME_WIDTH-0x78;game['mode']==0x0&&(game['bomb']['ox']=game['bar']['x']+0x78/0x2,game['bomb']['x']=game['bomb']['ox']-0xa);}}),Bomb=Class['create'](Sprite,{'initialize':function(){Sprite['call'](this,0x16,0x16),this['image']=game['assets']['block_icon_boll.png'],this['init']();},'init':function(){this['frame']=0x0,this['ox']=0x78/0x2+0xa,this['oy']=BLOCK_GAME_HEIGHT-BLOCK_BAR_MARGIN_BOTTOM-0x14,this['x']=this['ox']-0xa,this['y']=this['oy']-0xa,this['vy']=0x0,this['vx']=0x0;},'onenterframe':function(){if(game['mode']!=0x1&&game['mode']!=0x2)return;this['move']()&&(this['ox']=this['ox']+this['vx'],this['oy']=this['oy']+this['vy'],this['x']=this['ox']-0xa,this['y']=this['oy']-0xa);},'move':function(){var _0x757aa4=!![];if(game['bar']['time']>0x0)game['bar']['time']--;if(game['bar']['time']==0x0)game['bar']['frame']=0x0;this['ox']<0xa&&(this['ox']=0xa,this['vx']=-this['vx'],_0x757aa4=![]);this['ox']>BLOCK_GAME_WIDTH-0xa&&(this['ox']=BLOCK_GAME_WIDTH-0xa,this['vx']=-this['vx'],_0x757aa4=![]);this['oy']<0xa&&(this['oy']=0xa,this['vy']=-this['vy'],_0x757aa4=![]);if(this['intersect'](game['bar'])){this['vy']=-this['vy'],game['bomb']['frame']=0x0,game['bar']['frame']=0x1,game['bar']['time']=0x3,this['oy']=BLOCK_GAME_HEIGHT-BLOCK_BAR_MARGIN_BOTTOM-0xc;if(this['ox']<game['bar']['x']+0x1e)this['vx']=-Math['abs'](BLOCK_GAME_BALL_SPEED+0x3),this['vy']=-Math['abs'](BLOCK_GAME_BALL_SPEED-0x3);else{if(this['ox']>game['bar']['x']+0x5a)this['vx']=Math['abs'](BLOCK_GAME_BALL_SPEED+0x3),this['vy']=-Math['abs'](BLOCK_GAME_BALL_SPEED-0x3);else this['ox']>=game['bar']['x']+0x3a&&this['ox']<=game['bar']['x']+0x3e?(game['bomb']['frame']=0x1,this['vx']=this['vx']>0x0?BLOCK_GAME_BALL_SPEED:-BLOCK_GAME_BALL_SPEED,this['vy']=-BLOCK_GAME_BALL_SPEED):(this['vx']=this['vx']>0x0?BLOCK_GAME_BALL_SPEED:-BLOCK_GAME_BALL_SPEED,this['vy']=-BLOCK_GAME_BALL_SPEED);}}if(this['oy']>BLOCK_GAME_HEIGHT-0xa)return gameLose(),![];var _0x390912=BLOCK_GAME_WIDTH/BLOCK_GAME_BLOCK_SIZE,_0x1bae0a=BLOCK_GAME_HEIGHT/BLOCK_GAME_BLOCK_SIZE,_0x4fe7d6=parseInt((this['ox']+this['vx'])/BLOCK_GAME_BLOCK_SIZE),_0x566650=parseInt(this['oy']/BLOCK_GAME_BLOCK_SIZE);if(_0x4fe7d6>=0x0&&_0x4fe7d6<_0x390912&&_0x566650>=0x0&&_0x566650<_0x1bae0a){if(blockBase[_0x4fe7d6][_0x566650]){blockBase[_0x4fe7d6][_0x566650]=![],blockBaseNum--,drawBackImage(_0x4fe7d6,_0x566650);if(blockBaseNum==0x0&&game['mode']==0x1)return gameNextStage(),![];if(blockBaseNum==0x0&&game['mode']==0x2)return gameWin(),![];game['bomb']['frame']==0x0&&(this['vx']=-this['vx'],_0x757aa4=![]);}}_0x4fe7d6=parseInt(this['ox']/BLOCK_GAME_BLOCK_SIZE),_0x566650=parseInt((this['oy']+this['vy'])/BLOCK_GAME_BLOCK_SIZE);if(_0x4fe7d6>=0x0&&_0x4fe7d6<_0x390912&&_0x566650>=0x0&&_0x566650<_0x1bae0a){if(blockBase[_0x4fe7d6][_0x566650]){blockBase[_0x4fe7d6][_0x566650]=![],blockBaseNum--,drawBackImage(_0x4fe7d6,_0x566650);if(blockBaseNum==0x0&&game['mode']==0x1)return gameNextStage(),![];if(blockBaseNum==0x0&&game['mode']==0x2)return gameWin(),![];game['bomb']['frame']==0x0&&(this['vy']=-this['vy'],_0x757aa4=![]);}}return _0x757aa4;}}),PanelBar=Class['create'](Sprite,{'initialize':function(){Sprite['call'](this,0x78,0x10),this['image']=game['assets']['block_icon_panel.png'],this['init']();},'init':function(){this['x']=0xa,this['y']=BLOCK_GAME_HEIGHT-BLOCK_BAR_MARGIN_BOTTOM,this['time']=0x0;}}),window['onload']=function(){game['onload']=function(){imgFront1=game['assets']['block_image_front1.png']['_element'],imgFront2=game['assets']['block_image_front2.png']['_element'],imgBack=game['assets']['block_image_back.jpg']['_element'],imgWin=game['assets']['block_image_win.jpg']['_element'],game['restart']=new StartLabelSprite(),game['bomb']=new Bomb(),game['bar']=new PanelBar(),game['spriteScreen']=new SpriteScreen(),document['getElementById']('enchant-stage')['addEventListener']('mousemove',function(_0x56306b){var _0x1c2dc3=_0x56306b['pageX']-this['getBoundingClientRect']()['left']-game['bar']['width']/0x2;game['bar']['x']=_0x56306b['pageX']-this['getBoundingClientRect']()['left']-game['bar']['width']/0x2;if(game['bar']['x']<0x0)game['bar']['x']=0x0;if(game['bar']['x']>BLOCK_GAME_WIDTH-0x78)game['bar']['x']=BLOCK_GAME_WIDTH-0x78;game['mode']==0x0&&(game['bomb']['ox']=game['bar']['x']+0x78/0x2,game['bomb']['x']=game['bomb']['ox']-0xa);},![]),document['getElementById']('enchant-stage')['addEventListener']('click',function(_0x5e644f){if(_0x5e644f['pageY']<0x96)return;if(game['mode']==0x0)gameStart();if(game['mode']==0x9)gameRestart();},![]),initGame(imgFront1),game['spriteScreen']['image']=sf,scene['addChild'](game['spriteScreen']),scene['addChild'](game['restart']),scene['addChild'](game['bar']),scene['addChild'](game['bomb']),game['replaceScene'](scene);},game['start']();};function initGame(_0x41b800){sf['context']['clearRect'](0x0,0x0,sf['width'],sf['height']),sf['context']['drawImage'](_0x41b800,0x0,0x0),blockBaseNum=0x0,blockBaseNumMaster=0x0;for(var _0x5dd852=0x0;_0x5dd852<BLOCK_GAME_HEIGHT/BLOCK_GAME_BLOCK_SIZE;_0x5dd852++){for(var _0x4f414d=0x0;_0x4f414d<BLOCK_GAME_WIDTH/BLOCK_GAME_BLOCK_SIZE;_0x4f414d++){blockBase[_0x4f414d][_0x5dd852]=![],blockBaseMaster[_0x4f414d][_0x5dd852]=![],haveBlock(sf['context'],_0x4f414d,_0x5dd852)&&(blockBase[_0x4f414d][_0x5dd852]=!![],blockBaseMaster[_0x4f414d][_0x5dd852]=!![],blockBaseNum++,blockBaseNumMaster++);}}sf['context']['drawImage'](imgBack,0x0,0x0),_0x41b800==imgFront1&&sf['context']['drawImage'](imgFront2,0x0,0x0),sf['context']['drawImage'](_0x41b800,0x0,0x0);};function haveBlock(_0x210e9f,_0x19c074,_0x3699d7){var _0x482968=0x0,_0x1a7f8d=0x0,_0x499db2=_0x210e9f['getImageData'](_0x19c074*BLOCK_GAME_BLOCK_SIZE,_0x3699d7*BLOCK_GAME_BLOCK_SIZE,BLOCK_GAME_BLOCK_SIZE,BLOCK_GAME_BLOCK_SIZE);for(_0x1a7f8d=0x0;_0x1a7f8d<BLOCK_GAME_BLOCK_SIZE*BLOCK_GAME_BLOCK_SIZE;_0x1a7f8d++){if(_0x499db2['data'][_0x1a7f8d*0x4+0x3])_0x482968++;}return _0x482968>=BLOCK_GAME_MIN_BLOCK_PIXEL?!![]:![];};function drawBackImage(_0x9008fb,_0x234b4a){sf['context']['drawImage'](imgBack,_0x9008fb*BLOCK_GAME_BLOCK_SIZE,_0x234b4a*BLOCK_GAME_BLOCK_SIZE,BLOCK_GAME_BLOCK_SIZE,BLOCK_GAME_BLOCK_SIZE,_0x9008fb*BLOCK_GAME_BLOCK_SIZE,_0x234b4a*BLOCK_GAME_BLOCK_SIZE,BLOCK_GAME_BLOCK_SIZE,BLOCK_GAME_BLOCK_SIZE),game['mode']==0x1&&sf['context']['drawImage'](imgFront2,_0x9008fb*BLOCK_GAME_BLOCK_SIZE,_0x234b4a*BLOCK_GAME_BLOCK_SIZE,BLOCK_GAME_BLOCK_SIZE,BLOCK_GAME_BLOCK_SIZE,_0x9008fb*BLOCK_GAME_BLOCK_SIZE,_0x234b4a*BLOCK_GAME_BLOCK_SIZE,BLOCK_GAME_BLOCK_SIZE,BLOCK_GAME_BLOCK_SIZE);};function gameStart(){game['restart']['y']=-0x64,game['bomb']['vy']=BLOCK_GAME_BALL_SPEED,game['bomb']['vx']=BLOCK_GAME_BALL_SPEED,game['mode']=0x1;};function gameLose(){game['restart']['x']=BLOCK_GAME_WIDTH/0x2-game['restart']['width']/0x2,game['restart']['y']=BLOCK_GAME_HEIGHT/0x2-game['restart']['height']/0x2-0x32,game['restart']['frame']=0x1,game['bomb']['vy']=0x0,game['bomb']['vx']=0x0,game['bomb']['oy']=-0x64,game['bomb']['y']=-0x64,game['mode']=0x9;};function gameWin(){game['mode']=0xa,game['bomb']['vy']=0x0,game['bomb']['vx']=0x0,game['bomb']['oy']=-0x64,game['bomb']['y']=-0x64,game['bar']['y']=-0x64,sf['context']['drawImage'](imgWin,0x0,0x0);};function gameNextStage(){initGame(imgFront2),game['mode']=0x2;};function gameRestart(){initGame(imgFront1),game['restart']['init'](),game['bomb']['init'](),game['bar']['init'](),game['mode']=0x0;};
